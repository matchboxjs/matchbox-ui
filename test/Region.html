<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css"/>
    <title></title>
</head>
<body>

<div id="mocha"></div>

<script type="text/javascript" src="../matchbox-ui.debug.js"></script>
<script type="text/javascript" src="../node_modules/mocha/mocha.js"></script>
<script type="text/javascript" src="../node_modules/chai/chai.js"></script>
<script type="text/javascript">
    mocha.setup("bdd")
</script>
<script type="text/javascript">
    !function (ui, assert) {
        function test (name, fn) {
            it(name, function () {
                var element = document.createElement("div")
                document.body.appendChild(element)
                fn.call(this, element)
                document.body.removeChild(element)
            })
        }

        function createElement (tag, name) {
            var element = document.createElement(tag)
            element.dataset.element = name
            return element
        }

        var Element = ui.Element
        var Region = ui.Region

        describe("Region", function () {
            describe("children", function () {
                test("bare bone example", function (element) {
                    var child = createElement("div", "child")
                    element.appendChild(child)
                    var region = new (Region.extend({
                        elements: {
                            child: new ui.Child()
                        }
                    }))(element)
                    assert.equal(region.findElement("child"), child)
                })
                test("nonexistent child", function (element) {
                    var region = new (Region.extend({
                        elements: {
                            child: new ui.Child()
                        }
                    }))(element)
                    assert.isNull(region.findElement("child"))
                    assert.isNull(region.findElement("asdqwe"))
                })
                test("name override", function (element) {
                    var child = createElement("div", "other-child")
                    element.appendChild(child)
                    var region = new (Region.extend({
                        elements: {
                            child: new ui.Child("other-child")
                        }
                    }))(element)
                    assert.equal(region.findElement("child"), child)
                })
                test("multiple child", function (element) {
                    var child1 = createElement("div", "child")
                    var child2 = createElement("div", "child")
                    element.appendChild(child1)
                    element.appendChild(child2)
                    var region = new (Region.extend({
                        elements: {
                            child: new ui.Child({
                                multiple: true
                            })
                        }
                    }))(element)
                    assert.isArray(region.findElement("child"))
                    assert.lengthOf(region.findElement("child"), 2)
                    assert.equal(region.findElement("child")[0], child1)
                    assert.equal(region.findElement("child")[1], child2)
                })
                test("with constructor", function (element) {
                    var child = createElement("div", "child")
                    element.appendChild(child)
                    var ChildElement = Element.extend({})
                    var region = new (Region.extend({
                        elements: {
                            child: new ui.Child(ChildElement)
                        }
                    }))(element)
                    assert.instanceOf(region.findElement("child"), ChildElement)
                    assert.equal(region.findElement("child").element, child)
                })
                test("multiple with constructor", function (element) {
                    var child1 = createElement("div", "child")
                    var child2 = createElement("div", "child")
                    element.appendChild(child1)
                    element.appendChild(child2)
                    var ChildElement = Element.extend({})
                    var region = new (Region.extend({
                        elements: {
                            child: new ui.Child({
                                Constructor: ChildElement,
                                multiple: true
                            })
                        }
                    }))(element)
                    assert.isArray(region.findElement("child"))
                    assert.lengthOf(region.findElement("child"), 2)
                    assert.instanceOf(region.findElement("child")[0], ChildElement)
                    assert.instanceOf(region.findElement("child")[1], ChildElement)
                    assert.equal(region.findElement("child")[0].element, child1)
                    assert.equal(region.findElement("child")[1].element, child2)
                })
            })
        })
    }(window.matchboxUi, window.chai.assert)
</script>
<script type="text/javascript">
    mocha.run()
</script>
</body>
</html>
