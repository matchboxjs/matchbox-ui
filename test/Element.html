<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../node_modules/mocha/mocha.css"/>
    <title></title>
</head>
<body>

<div id="mocha"></div>

<script type="text/javascript" src="../matchbox-ui.debug.js"></script>
<script type="text/javascript" src="../node_modules/mocha/mocha.js"></script>
<script type="text/javascript" src="../node_modules/chai/chai.js"></script>
<script type="text/javascript">
    mocha.setup("bdd")
</script>
<script type="text/javascript">
    !function (ui, assert) {
        function test (name, fn) {
            it(name, function () {
                var element = document.createElement("div")
                document.body.appendChild(element)
                fn.call(this, element)
                document.body.removeChild(element)
            })
        }

        function createChild (tag, name) {
            var element = document.createElement(tag)
            element.dataset.child = name
            return element
        }

        var Element = ui.Element

        describe("Element", function () {
            describe("children", function () {
                test("bare bone example", function (element) {
                    var child = createChild("div", "test:child")
                    element.appendChild(child)
                    var el = new (Element.extend({
                        children: {
                            child: new ui.Child()
                        },
                        prototype: {
                            name: "test"
                        }
                    }))(element)
                    assert.equal(el.findChild("child"), child)
                })
                test("nonexistent child", function (element) {
                    var el = new (Element.extend({
                        children: {
                            child: new ui.Child()
                        },
                        prototype: {
                            name: "test"
                        }
                    }))(element)
                    assert.isNull(el.findChild("child"))
                    assert.isNull(el.findChild("asdqwe"))
                })
                test("name override", function (element) {
                    var child = createChild("div", "test:other-child")
                    element.appendChild(child)
                    var el = new (Element.extend({
                        children: {
                            child: new ui.Child("other-child")
                        },
                        prototype: {
                            name: "test"
                        }
                    }))(element)
                    assert.equal(el.findChild("child"), child)
                })
                test("multiple child", function (element) {
                    var child1 = createChild("div", "test:child")
                    var child2 = createChild("div", "test:child")
                    element.appendChild(child1)
                    element.appendChild(child2)
                    var el = new (Element.extend({
                        children: {
                            child: new ui.Child({
                                multiple: true
                            })
                        },
                        prototype: {
                            name: "test"
                        }
                    }))(element)
                    assert.isNotNull(el.findChild("child"))
                    assert.lengthOf(el.findChild("child"), 2)
                    assert.equal(el.findChild("child")[0], child1)
                    assert.equal(el.findChild("child")[1], child2)
                })
                test("with constructor", function (element) {
                    var child = createChild("div", "test:child")
                    element.appendChild(child)
                    var ChildElement = Element.extend({})
                    var el = new (Element.extend({
                        children: {
                            child: new ui.Child(ChildElement)
                        },
                        prototype: {
                            name: "test"
                        }
                    }))(element)
                    assert.instanceOf(el.findChild("child"), ChildElement)
                    assert.equal(el.findChild("child").element, child)
                })
            })
        })
    }(window.matchboxUi, window.chai.assert)
</script>
<script type="text/javascript">
    mocha.run()
</script>
</body>
</html>
